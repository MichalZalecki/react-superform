!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("lodash"),require("validator")):"function"==typeof define&&define.amd?define("Superform",["react","lodash","validator"],t):"object"==typeof exports?exports.Superform=t(require("react"),require("lodash"),require("validator")):e.Superform=t(e.React,e._,e.validator)}(this,function(e,t,r){return function(e){function t(a){if(r[a])return r[a].exports;var u=r[a]={exports:{},id:a,loaded:!1};return e[a].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(1),n=a(u);t["default"]=n["default"],e.exports=t["default"]},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function u(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),f=r(2),h=a(f),c=r(3),d=a(c),v=r(4),m=a(v),p=function(e){function t(e){i(this,t);var r=s(this,Object.getPrototypeOf(t).call(this,e));return r.state={data:{},errors:{},links:{},submitted:!1},r}return o(t,e),l(t,[{key:"onSuccessSubmit",value:function(e){}},{key:"onErrorSubmit",value:function(e,t){}},{key:"handleChange",value:function(e){var t=this,r=e.target.name,a=this._getNodeValue(e.target),u=this._validateNode(e.target),n=this._getLink(e.target);return n&&this._setLink(r,n),Promise.all([this._updateDataOf(r,a),this._updateErrorsOf(r,u)]).then(function(){return t._checkLinks(r)})}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault();var r=this._createErrors();return this.markAsSubmitted().then(function(){return t._updateErrors(r)}).then(function(){return t.isFormValid()?t.onSuccessSubmit(t.state.data):t.onErrorSubmit(t.state.errors,t.state.data)})}},{key:"markAsSubmitted",value:function(){var e=this;return new Promise(function(t){e.setState({submitted:!0},t)})}},{key:"isSubmited",value:function(){return this.state.submitted}},{key:"getValueOf",value:function(e){return this.state.data[e]}},{key:"linkStateOf",value:function(e){var t=this;return{value:this.state.data[e],requestChange:function(){return t.handleChange({target:t.refs[e]})}}}},{key:"getData",value:function(){return this.state.data}},{key:"getErrors",value:function(){return(0,d["default"])(this.state.errors).omitBy(function(e){return!e.length}).value()}},{key:"getErrorsOf",value:function(e){return(0,d["default"])(this.getErrors()).pick(e).get(e,[])}},{key:"isFormValid",value:function(){var e=(0,d["default"])(this.getErrors()).keys().isEmpty();return e}},{key:"isFieldValid",value:function(e){var t=(0,d["default"])(this.getErrorsOf(e)).isEmpty();return t}},{key:"getErrorMessageOf",value:function(e){if(!this.isSubmited()||this.isFieldValid(e))return null;var t=(0,d["default"])(this.getErrorsOf(e)).first(),r=this._getMessage(e,t.rule);return t.data?this._parseMessage(r,t.data):r}},{key:"_createErrors",value:function(){var e=this;return(0,d["default"])(this.refs).mapValues(function(t){return e._validateNode(t)}).omitBy(function(e){return!e.length}).value()}},{key:"_updateErrors",value:function(e){var t=this;return new Promise(function(r){t.setState({errors:e},r)})}},{key:"_updateDataOf",value:function(e,t){var r=this;return new Promise(function(a){var u=d["default"].assign({},r.state.data,n({},e,t));r.setState({data:u},a)})}},{key:"_updateErrorsOf",value:function(e,t){var r=this;return new Promise(function(a){var u=d["default"].assign({},r.state.errors,n({},e,t));r.setState({errors:u},a)})}},{key:"_getCustomMessageForRuleOf",value:function(e,t){var r=this._getCustomMessagesOf(e),a=r[t];return a}},{key:"_getCustomMessagesOf",value:function(e){var t=this.refs[e].dataset.messages,r=t?JSON.parse(t):{};return r}},{key:"_getMessage",value:function(e,t){var r=this._getCustomMessageForRuleOf(e,t)||this.constructor.DEFAULT_MESSAGES[t];if(!r)throw new Error("Superform: There is no message for such rule. Passed: "+t);return r}},{key:"_parseMessage",value:function(e,t){var r=e.replace(":data",t);return r}},{key:"_validateNode",value:function(e){var t=this._getNodeValue(e),r=this._collectRules(e),a=this._validate(t,r);return a}},{key:"_getLink",value:function(e){return e.dataset.equals||null}},{key:"_setLink",value:function(e,t){var r=this;return new Promise(function(a){var i=d["default"].uniq([].concat(u(r.state.links[t]||[]),[e])),s=d["default"].assign({},r.state.links,n({},t,i));if(e===t)throw new Error("Cannot cheack equality to itself: "+t);if(d["default"].includes(i,t))throw new Error("Circular equality check: "+t);r.setState({links:s},a)})}},{key:"_checkLinks",value:function(e){var t=this;(this.state.links[e]||[]).forEach(function(e){t.handleChange({target:t.refs[e]})})}},{key:"_getNodeValue",value:function(e){switch(e.type){case"checkbox":return e.checked;default:return e.value}}},{key:"_collectRules",value:function(e){var t={email:"email"===e.type,url:"url"===e.type,number:"number"===e.type,pattern:e.pattern,required:e.required,min:e.getAttribute("min"),max:e.getAttribute("max"),minLength:e.getAttribute("minLength"),maxLength:e.getAttribute("maxLength"),equals:e.dataset.equals};return t}},{key:"_validate",value:function(e,t){var r=[];return t.required&&!this._valueExists(e)&&r.push({rule:"required"}),t.pattern?t.pattern&&!this._valueMatchesPattern(e,t.pattern)&&r.push({rule:"pattern"}):(t.email&&!m["default"].isEmail(e)&&r.push({rule:"email"}),t.url&&!m["default"].isURL(e,{require_protocol:!0})&&r.push({rule:"url"}),t.number&&!m["default"].isNumeric(e)&&r.push({rule:"number"})),(t.required||this._valueExists(e))&&(t.min&&!this._valueIsGreaterOrEqual(e,t.min)&&r.push({rule:"min",data:t.min}),t.max&&!this._valueIsLowerOrEqual(e,t.max)&&r.push({rule:"max",data:t.max}),t.minLength&&!this._valueLengthIsGreaterOrEqual(e,t.minLength)&&r.push({rule:"minLength",data:t.minLength}),t.maxLength&&!this._valueLengthIsLowerOrEqual(e,t.maxLength)&&r.push({rule:"maxLength",data:t.maxLength})),t.equals&&!this._valueEqualsValueOf(e,t.equals)&&r.push({rule:"equals",data:t.equals}),r}},{key:"_valueMatchesPattern",value:function(e,t){return new RegExp(t).test(e)}},{key:"_valueExists",value:function(e){return!!e}},{key:"_valueIsGreaterOrEqual",value:function(e,t){var r=parseInt(e,10),a=parseInt(t,10);if(Number.isNaN(a))throw Error('Superform: Invalid "min" rule. Use only with numbers. Passed: '+JSON.stringify(t));return Number.isNaN(r)?!1:r>=a}},{key:"_valueIsLowerOrEqual",value:function(e,t){var r=parseInt(e,10),a=parseInt(t,10);if(Number.isNaN(a))throw Error('Superform: Invalid "max" rule. Use only with numbers. Passed: '+JSON.stringify(t));return Number.isNaN(r)?!1:a>=r}},{key:"_valueLengthIsGreaterOrEqual",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=arguments[1],r=e.length,a=parseInt(t,10);if(Number.isNaN(a))throw Error('Superform: Invalid "minLength" rule. Use only with numbers. Passed: '+JSON.stringify(t));return r>=a}},{key:"_valueLengthIsLowerOrEqual",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=arguments[1],r=e.length,a=parseInt(t,10);if(Number.isNaN(a))throw Error('Superform: Invalid "maxLength" rule. Use only with numbers. Passed: '+JSON.stringify(t));return a>=r}},{key:"_valueEqualsValueOf",value:function(e,t){return e===this.getValueOf(t)}}]),t}(h["default"].Component);p.DEFAULT_MESSAGES={email:"This is not a valid email.",url:"This is not a valid URL.",number:"This is not a number.",required:"Field is required.",pattern:"Value format is invalid.",min:"Value should be greater or equal :data.",max:"Value should be lower or equal :data.",minLength:"Value is too short. Value length should be greater or equal :data.",maxLength:"Value is too long. Value length should be lower or equal :data.",equals:"Value must be the same as :data."},t["default"]=p,e.exports=t["default"]},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r}])});
//# sourceMappingURL=react-superform.min.js.map